load system io.
load system patterns.
load system math.

-- Expirmental patterns library test

let failures = 0.
let EXPECTED = pattern with Exception( "PatternMatchFailed" , _ ).

--                                      **********************
--                                      **** prime        ****
--                                      **********************
let x:*patterns@PRIME = 2.
let x:*patterns@PRIME = 3.
let x:*patterns@PRIME = 5.
let x:*patterns@PRIME = 11.
let x:*patterns@PRIME = 13.
let x:*patterns@PRIME = 17.
let x:*patterns@PRIME = 97.
let x:*patterns@PRIME = 83.
let x:*patterns@PRIME = 15485863.

try
    let x:*patterns@PRIME = 10.
    let failures = failures + 1.
catch *EXPECTED do
    .
end
try
    let x:*patterns@PRIME = 1024.
    let failures = failures + 1.
catch *EXPECTED do
    .
end
try
    let x:*patterns@PRIME = 999.
    let failures = failures + 1.
catch *EXPECTED do
    .
end
try
    let x:*patterns@PRIME = 63.
    let failures = failures + 1.
catch *EXPECTED do
    .
end
--                                      **********************
--                                      **** natural      ****
--                                      **********************
let x:*patterns@NATURAL = 1.
let x:*patterns@NATURAL = 2.
let x:*patterns@NATURAL = 5.
let x:*patterns@NATURAL = 1486987.
let x:*patterns@NATURAL = 1010101.
let x:*patterns@NATURAL = 1.0.
let x:*patterns@NATURAL = 5.000.
let x:*patterns@NATURAL = 53456.000.

try
    let x:*patterns@NATURAL = -10.
    let failures = failures + 1.
catch *EXPECTED do
    .
end
try
    let x:*patterns@NATURAL = 0.
    let failures = failures + 1.
catch *EXPECTED do
    .
end
try
    let x:*patterns@NATURAL = 12.36.
    let failures = failures + 1.
catch *EXPECTED do
    .
end
try
    let x:*patterns@NATURAL = 1.000001.
    let failures = failures + 1.
catch *EXPECTED do
    .
end
try
    let x:*patterns@NATURAL = 105464.99999.
    let failures = failures + 1.
catch *EXPECTED do
    .
end
try
    let x:*patterns@NATURAL = -1.0.
    let failures = failures + 1.
catch *EXPECTED do
    .
end
try
    let x:*patterns@NATURAL = -0.1.
    let failures = failures + 1.
catch *EXPECTED do
    .
end
--                                      **********************
--                                      **** fibonacci    ****
--                                      **********************
let x:*patterns@FIBONACCI = 2.
let x:*patterns@FIBONACCI = 3.
let x:*patterns@FIBONACCI = 5.
let x:*patterns@FIBONACCI = 8.
let x:*patterns@FIBONACCI = 13.
let x:*patterns@FIBONACCI = 21.
let x:*patterns@FIBONACCI = 55.
let x:*patterns@FIBONACCI = 377.

try
    let x:*patterns@FIBONACCI = -0.1.
    let failures = failures + 1.
catch *EXPECTED do
    .
end
try
    let x:*patterns@FIBONACCI = 16.
    let failures = failures + 1.
catch *EXPECTED do
    .
end
try
    let x:*patterns@FIBONACCI = 100.
    let failures = failures + 1.
catch *EXPECTED do
    .
end
try
    let x:*patterns@FIBONACCI = -11.
    let failures = failures + 1.
catch *EXPECTED do
    .
end
try
    let x:*patterns@FIBONACCI = 360.
    let failures = failures + 1.
catch *EXPECTED do
    .
end
try
    let x:*patterns@FIBONACCI = 100.
    let failures = failures + 1.
catch *EXPECTED do
    .
end
--                                      **********************
--                                      **** pos/neg      ****
--                                      **********************
let x:*patterns@POSITIVE = 1.
let x:*patterns@POSITIVE = 111111111.
let x:*patterns@POSITIVE = 10.
let x:*patterns@POSITIVE = 1235.3654.

let x:*patterns@POS_INT = 12.
let x:*patterns@POS_INT = 12213.
let x:*patterns@POS_INT = 1.

let x:*patterns@POS_REAL = 1.23.
let x:*patterns@POS_REAL = 15222.23.
let x:*patterns@POS_REAL = 0.00023.

let x:*patterns@NEGATIVE = -1.
let x:*patterns@NEGATIVE = -111111111.
let x:*patterns@NEGATIVE = -10.
let x:*patterns@NEGATIVE = -1235.3654.

let x:*patterns@NEG_INT = -12.
let x:*patterns@NEG_INT = -12213.
let x:*patterns@NEG_INT = -1.

let x:*patterns@NEG_REAL = -1.23.
let x:*patterns@NEG_REAL = -15222.23.
let x:*patterns@NEG_REAL = -0.00023.

try
    let x:*patterns@POSITIVE = -100.
    let failures = failures + 1.
catch *EXPECTED do
    .
end
try
    let x:*patterns@POSITIVE = -0.001.
    let failures = failures + 1.
catch *EXPECTED do
    .
end
try
    let x:*patterns@POS_INT = -12.
    let failures = failures + 1.
catch *EXPECTED do
    .
end
try
    let x:*patterns@POS_INT = 1.2.
    let failures = failures + 1.
catch *EXPECTED do
    .
end
try
    let x:*patterns@POS_REAL = -1.2.
    let failures = failures + 1.
catch *EXPECTED do
    .
end
try
    let x:*patterns@POS_REAL = 1.
    let failures = failures + 1.
catch *EXPECTED do
    .
end
try
    let x:*patterns@NEGATIVE = 0.001.
    let failures = failures + 1.
catch *EXPECTED do
    .
end
try
    let x:*patterns@NEGATIVE = 12.
    let failures = failures + 1.
catch *EXPECTED do
    .
end
try
    let x:*patterns@NEG_INT = -12.002.
    let failures = failures + 1.
catch *EXPECTED do
    .
end
try
    let x:*patterns@NEG_INT = 12.
    let failures = failures + 1.
catch *EXPECTED do
    .
end
try
    let x:*patterns@NEG_REAL = 1.2.
    let failures = failures + 1.
catch *EXPECTED do
    .
end
try
    let x:*patterns@NEG_REAL = -51.
    let failures = failures + 1.
catch *EXPECTED do
    .
end
--                                      **********************
--                                      **** whole numbers****
--                                      **********************
let x:*patterns@WHOLE = 1.
let x:*patterns@WHOLE = 1.0.
let x:*patterns@WHOLE = 1236.
let x:*patterns@WHOLE = 12.0.

let x:*patterns@WHOLE_INT = 1.
let x:*patterns@WHOLE_INT = 1.
let x:*patterns@WHOLE_INT = 1.

let x:*patterns@WHOLE_REAL = 1.0.
let x:*patterns@WHOLE_REAL = 2.0.
let x:*patterns@WHOLE_REAL = 1336.0.

try
    let x:*patterns@WHOLE = -51.
    let failures = failures + 1.
catch *EXPECTED do
    .
end
try
    let x:*patterns@WHOLE = -1.0.
    let failures = failures + 1.
catch *EXPECTED do
    .
end
try
    let x:*patterns@WHOLE = 0.66666.
    let failures = failures + 1.
catch *EXPECTED do
    .
end
try
    let x:*patterns@WHOLE = -1.
    let failures = failures + 1.
catch *EXPECTED do
    .
end
try
    let x:*patterns@WHOLE_INT = -1.
    let failures = failures + 1.
catch *EXPECTED do
    .
end
try
    let x:*patterns@WHOLE_INT = -6.
    let failures = failures + 1.
catch *EXPECTED do
    .
end
try
    let x:*patterns@WHOLE_REAL = 1.
    let failures = failures + 1.
catch *EXPECTED do
    .
end
try
    let x:*patterns@WHOLE_REAL = 1.0000000001.
    let failures = failures + 1.
catch *EXPECTED do
    .
end
try
    let x:*patterns@WHOLE_REAL = -2.5.
    let failures = failures + 1.
catch *EXPECTED do
    .
end
try
    let x:*patterns@WHOLE_REAL = -0.25.
    let failures = failures + 1.
catch *EXPECTED do
    .
end
try
    let x:*patterns@WHOLE_REAL = 22.00000000000025.
    let failures = failures + 1.
catch *EXPECTED do
    .
end
--                                      **********************
--                                      **** natural      ****
--                                      **********************
let x:*patterns@NATURAL = 1.
let x:*patterns@NATURAL = 1.0.
let x:*patterns@NATURAL = 13.0.
let x:*patterns@NATURAL = 100.
let x:*patterns@NATURAL = 16.

let x:*patterns@NAT_INT = 16.
let x:*patterns@NAT_INT = 6.
let x:*patterns@NAT_INT = 10000.

let x:*patterns@NAT_REAL = 10000.0.
let x:*patterns@NAT_REAL = 1.0.
let x:*patterns@NAT_REAL = 16.0.

try
    let x:*patterns@NATURAL = 22.00000000000025.
    let failures = failures + 1.
catch *EXPECTED do
    .
end
try
    let x:*patterns@NATURAL = 0.
    let failures = failures + 1.
catch *EXPECTED do
    .
end
try
    let x:*patterns@NATURAL = 0.0.
    let failures = failures + 1.
catch *EXPECTED do
    .
end
try
    let x:*patterns@NATURAL = -1.
    let failures = failures + 1.
catch *EXPECTED do
    .
end
try
    let x:*patterns@NAT_INT = -1.
    let failures = failures + 1.
catch *EXPECTED do
    .
end
try
    let x:*patterns@NAT_INT = -1.5.
    let failures = failures + 1.
catch *EXPECTED do
    .
end
try
    let x:*patterns@NAT_INT = 1.666.
    let failures = failures + 1.
catch *EXPECTED do
    .
end
try
    let x:*patterns@NAT_REAL = 1.666.
    let failures = failures + 1.
catch *EXPECTED do
    .
end
try
    let x:*patterns@NAT_REAL = -2.0.
    let failures = failures + 1.
catch *EXPECTED do
    .
end
try
    let x:*patterns@NAT_REAL = 20.3333.
    let failures = failures + 1.
catch *EXPECTED do
    .
end
try
    let x:*patterns@NAT_REAL = 2.
    let failures = failures + 1.
catch *EXPECTED do
    .
end
--                                      **********************
--                                      **** zero         ****
--                                      **********************
let x:*patterns@ZERO = 0.
let x:*patterns@ZERO = 0.0.

try
    let x:*patterns@ZERO = 2.
    let failures = failures + 1.
catch *EXPECTED do
    .
end
try
    let x:*patterns@ZERO = 0.00000000000001.
    let failures = failures + 1.
catch *EXPECTED do
    .
end
try
    let x:*patterns@ZERO = -0.2.
    let failures = failures + 1.
catch *EXPECTED do
    .
end
try
    let x:*patterns@ZERO = -10.
    let failures = failures + 1.
catch *EXPECTED do
    .
end
--                                      **********************
--                                      **** even/odd     ****
--                                      **********************
let x:*patterns@EVEN = 2.
let x:*patterns@EVEN = 16.
let x:*patterns@EVEN = 2048.
let x:*patterns@ODD = 1.
let x:*patterns@ODD = 111117.
let x:*patterns@ODD = 3.

try
    let x:*patterns@EVEN = 1.
    let failures = failures + 1.
catch *EXPECTED do
    .
end
try
    let x:*patterns@EVEN = 2.01.
    let failures = failures + 1.
catch *EXPECTED do
    .
end
try
    let x:*patterns@EVEN = 7.
    let failures = failures + 1.
catch *EXPECTED do
    .
end
try
    let x:*patterns@ODD = 0.7.
    let failures = failures + 1.
catch *EXPECTED do
    .
end
try
    let x:*patterns@ODD = 2.
    let failures = failures + 1.
catch *EXPECTED do
    .
end
try
    let x:*patterns@ODD = 1024.
    let failures = failures + 1.
catch *EXPECTED do
    .
end
--                                      **********************
--                                      **** containers   ****
--                                      **********************
let x:*patterns@INT_LIST = [1,2,3,4].
let x:*patterns@INT_LIST = [10].
let x:*patterns@INT_LIST = [-1,15,32].

try
    let x:*patterns@INT_LIST = [1,2,3,4,5,6,7,8.2345,9,10,11,12,13,14,15].
    let failures = failures + 1.
catch *EXPECTED do
    .
end

assert(failures == 0).
io@println "PASS".